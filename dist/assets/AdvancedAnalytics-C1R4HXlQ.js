import{r as e,s,j as t,T as a,U as i,A as l,w as c,V as o,Y as n,Z as r}from"./react-vendor-CYm809Et.js";import{apiService as d}from"./api-BZ6vNX7b.js";import{L as u}from"./LoadingSkeleton-DA_UOSRD.js";import{E as m,b as x,a as h}from"./exportUtils-CXa4SXtf.js";import"./vendor-DC1Pnyyi.js";import"./chart-vendor-hJRC9QiP.js";import"./http-vendor-CHM7ATol.js";import"./authStore-D2_G-NGY.js";import"./utils-vendor-YtSAaKOK.js";const p=()=>{const p=e.useRef(null),g=e.useRef(null),j=e.useRef(null),{data:b,isLoading:f}=s({queryKey:["analytics-metrics"],queryFn:async()=>{const[e,s,t]=await Promise.all([d.kumomta.getMetrics(),d.kumomta.getBounces(),d.queue.getMetrics()]);return{kumomta:e.data,bounces:s.data,queue:t.data}},refetchInterval:3e4}),N=e.useMemo(()=>{if(!b?.kumomta)return 0;const e=b.kumomta.messages_sent||1;return(e-(b.kumomta.bounces||0))/e*100},[b]),y=e.useMemo(()=>b?.bounces?{labels:["Hard Bounces","Soft Bounces"],datasets:[{data:[b.bounces.hard_bounces||0,b.bounces.soft_bounces||0],backgroundColor:["#EF4444","#F59E0B"],borderWidth:0}]}:null,[b]),v=e.useMemo(()=>b?.queue?{labels:["Waiting","Processing","Completed"],datasets:[{data:[b.queue.totalWaiting||0,b.queue.totalProcessing||0,b.queue.totalCompleted||0],backgroundColor:["#FBBF24","#3B82F6","#10B981"],borderWidth:0}]}:null,[b]),w=e.useMemo(()=>{if(!b?.bounces?.classifications)return null;const e=b.bounces.classifications.slice(0,5);return{labels:e.map(e=>e.code),datasets:[{label:"Count",data:e.map(e=>e.count),backgroundColor:"#8B5CF6"}]}},[b]);return f?t.jsxs("div",{className:"space-y-6",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Advanced Analytics"}),t.jsx("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:t.jsx(u,{type:"card",count:4})})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Advanced Analytics"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Detailed insights into your email delivery performance"})]}),t.jsx(m,{onExport:e=>{if(b)try{if("pdf"===e){const e={};p.current&&(e["Bounce Distribution"]=p.current.toBase64Image()),g.current&&(e["Queue Status"]=g.current.toBase64Image()),j.current&&(e["Top Bounce Classifications"]=j.current.toBase64Image());const s={successRate:N,bounces:b.bounces,queueEfficiency:b.queue?(b.queue.totalCompleted||0)/((b.queue.totalCompleted||0)+(b.queue.totalWaiting||0)+(b.queue.totalProcessing||0)||1)*100:0,throughput:b.kumomta?.throughput||0};x(s,e)}else if(b.bounces?.classifications){const e=(b.bounces.hard_bounces||0)+(b.bounces.soft_bounces||0),s=b.bounces.classifications.map(s=>({code:s.code,description:s.description,count:s.count,percentage:(s.count/e*100).toFixed(2)}));h(s,`analytics-export-${Date.now()}.csv`)}}catch(s){}},disabled:!b,formats:["pdf","csv"],label:"Export"})]}),t.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4",children:[t.jsx("div",{className:"rounded-lg bg-white p-6 shadow",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"rounded-full p-3 "+(N>=95?"bg-green-100":"bg-yellow-100"),children:N>=95?t.jsx(a,{className:"h-6 w-6 "+(N>=95?"text-green-600":"text-yellow-600")}):t.jsx(i,{className:"h-6 w-6 text-yellow-600"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Success Rate"}),t.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[N.toFixed(2),"%"]})]})]})}),t.jsx("div",{className:"rounded-lg bg-white p-6 shadow",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"rounded-full bg-red-100 p-3",children:t.jsx(l,{className:"h-6 w-6 text-red-600"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Bounces"}),t.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:(b?.bounces?.hard_bounces||0)+(b?.bounces?.soft_bounces||0)})]})]})}),t.jsx("div",{className:"rounded-lg bg-white p-6 shadow",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"rounded-full bg-blue-100 p-3",children:t.jsx(c,{className:"h-6 w-6 text-blue-600"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Queue Efficiency"}),t.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[b?.queue?((b.queue.totalCompleted||0)/((b.queue.totalCompleted||0)+(b.queue.totalWaiting||0)+(b.queue.totalProcessing||0)||1)*100).toFixed(1):0,"%"]})]})]})}),t.jsx("div",{className:"rounded-lg bg-white p-6 shadow",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"rounded-full bg-purple-100 p-3",children:t.jsx(a,{className:"h-6 w-6 text-purple-600"})}),t.jsxs("div",{className:"ml-4",children:[t.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Throughput"}),t.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:[b?.kumomta?.throughput||0,"/min"]})]})]})})]}),t.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[y&&t.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[t.jsx("h3",{className:"mb-4 text-lg font-medium text-gray-900",children:"Bounce Distribution"}),t.jsx("div",{className:"h-64",children:t.jsx(o,{ref:p,data:y,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}})})]}),v&&t.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[t.jsx("h3",{className:"mb-4 text-lg font-medium text-gray-900",children:"Queue Status"}),t.jsx("div",{className:"h-64",children:t.jsx(n,{ref:g,data:v,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}})})]}),w&&t.jsxs("div",{className:"rounded-lg bg-white p-6 shadow lg:col-span-2",children:[t.jsx("h3",{className:"mb-4 text-lg font-medium text-gray-900",children:"Top Bounce Classifications"}),t.jsx("div",{className:"h-64",children:t.jsx(r,{ref:j,data:w,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})})]})]}),b?.bounces?.classifications&&t.jsxs("div",{className:"rounded-lg bg-white shadow",children:[t.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Detailed Bounce Classifications"})}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[t.jsx("thead",{className:"bg-gray-50",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Code"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Count"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Percentage"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:b.bounces.classifications.map((e,s)=>{const a=(b.bounces.hard_bounces||0)+(b.bounces.soft_bounces||0),i=e.count/a*100;return t.jsxs("tr",{children:[t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.code}),t.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:e.description}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.count}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[i.toFixed(2),"%"]})]},s)})})]})})]})]})};export{p as default};
