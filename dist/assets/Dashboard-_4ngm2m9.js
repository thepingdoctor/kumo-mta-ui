import{r as e,s as t,j as s,t as a,k as r,v as d,w as l,x as i,y as n}from"./react-vendor-CYm809Et.js";import{apiService as c}from"./api-BZ6vNX7b.js";import{L as o}from"./LoadingSkeleton-DA_UOSRD.js";import{C as x,a as m,b as h,c as g,d as u,p as j,e as y,f as k,i as p}from"./chart-vendor-hJRC9QiP.js";import"./vendor-DC1Pnyyi.js";import"./http-vendor-CHM7ATol.js";import"./authStore-D2_G-NGY.js";import"./utils-vendor-YtSAaKOK.js";x.register(m,h,g,u,j,y,k,p);const b=()=>{const{data:x,isLoading:m,error:h}=t({queryKey:["kumo-metrics"],queryFn:async()=>(e=>{const t={};for(const[s,a]of Object.entries(e)){const e="object"==typeof a&&"value"in a?a.value:0;s.includes("messages_sent")?t.messages_sent=e:s.includes("bounce")?t.bounces=e:s.includes("delayed")?t.delayed=e:s.includes("throughput")?t.throughput=e:s.includes("connection")&&s.includes("count")&&(t.active_connections=e),t[s]=e}return t})((await c.kumomta.getMetrics()).data),refetchInterval:15e3,retry:3}),{data:g}=t({queryKey:["queue-metrics"],queryFn:async()=>(await c.queue.getMetrics()).data,refetchInterval:15e3,retry:3}),{chartData:u,isLoading:j}=((s="messages_sent",a=24)=>{const[r,d]=e.useState([]),{data:l}=t({queryKey:["kumo-metrics-chart"],queryFn:async()=>(await c.kumomta.getMetrics()).data,refetchInterval:5e3,retry:3});return e.useEffect(()=>{if(l&&void 0!==l[s]){const e=(new Date).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});d(t=>{const r=[...t,{timestamp:e,value:l[s]}];return r.length>a?r.slice(r.length-a):r})}},[l,s,a]),{chartData:e.useMemo(()=>0===r.length?{labels:[],datasets:[{label:"Loading...",data:[],borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4}]}:{labels:r.map(e=>e.timestamp),datasets:[{label:"Emails Sent",data:r.map(e=>e.value),borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4}]},[r]),isLoading:0===r.length,dataPointCount:r.length}})("messages_sent",24),y=e.useMemo(()=>({sent:x?.messages_sent||0,bounced:x?.bounces||0,delayed:x?.delayed||0,throughput:x?.throughput||0}),[x]),k=e.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!0,text:"Hourly Email Throughput (Last 24 Hours)",font:{size:16,weight:"bold"}},tooltip:{mode:"index",intersect:!1}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Messages Sent"}},x:{title:{display:!0,text:"Time"}}}}),[]);return m?s.jsxs("div",{className:"space-y-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-dark-text",children:"Dashboard"}),s.jsx("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4",children:s.jsx(o,{type:"stat",count:4})}),s.jsx(o,{type:"card",count:2})]}):h?s.jsxs("div",{className:"space-y-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-dark-text",children:"Dashboard"}),s.jsx("div",{className:"rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 p-6",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(a,{className:"h-6 w-6 text-red-600 dark:text-red-400"}),s.jsxs("div",{className:"ml-3",children:[s.jsx("h3",{className:"text-sm font-medium text-red-800 dark:text-red-300",children:"Failed to load metrics"}),s.jsx("p",{className:"mt-1 text-sm text-red-700 dark:text-red-400",children:"Unable to connect to KumoMTA server. Please check your connection and try again."})]})]})})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-dark-text",children:"Dashboard"}),s.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4",children:[s.jsx("div",{className:"rounded-lg bg-white dark:bg-dark-surface p-6 shadow-md dark:shadow-xl",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(r,{className:"h-12 w-12 text-blue-500 dark:text-blue-400","aria-hidden":"true"}),s.jsxs("div",{className:"ml-4",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Emails Sent"}),s.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-dark-text",children:y.sent.toLocaleString()})]})]})}),s.jsx("div",{className:"rounded-lg bg-white dark:bg-dark-surface p-6 shadow-md dark:shadow-xl",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(a,{className:"h-12 w-12 text-red-500 dark:text-red-400","aria-hidden":"true"}),s.jsxs("div",{className:"ml-4",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Bounces"}),s.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-dark-text",children:y.bounced.toLocaleString()})]})]})}),s.jsx("div",{className:"rounded-lg bg-white dark:bg-dark-surface p-6 shadow-md dark:shadow-xl",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(d,{className:"h-12 w-12 text-yellow-500 dark:text-yellow-400","aria-hidden":"true"}),s.jsxs("div",{className:"ml-4",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Delayed"}),s.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-dark-text",children:y.delayed.toLocaleString()})]})]})}),s.jsx("div",{className:"rounded-lg bg-white dark:bg-dark-surface p-6 shadow-md dark:shadow-xl",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(l,{className:"h-12 w-12 text-green-500 dark:text-green-400","aria-hidden":"true"}),s.jsxs("div",{className:"ml-4",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Throughput"}),s.jsxs("p",{className:"text-2xl font-semibold text-gray-900 dark:text-dark-text",children:[y.throughput,"/min"]})]})]})})]}),s.jsx("div",{className:"rounded-lg bg-white dark:bg-dark-surface p-6 shadow-md dark:shadow-xl",children:s.jsx("div",{className:"h-96",children:j?s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Loading chart data..."})}):s.jsx(i,{options:k,data:u})})}),s.jsxs("div",{className:"rounded-lg bg-white dark:bg-dark-surface p-6 shadow-md dark:shadow-xl",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-dark-text",children:"Server Status"}),s.jsxs("div",{className:"mt-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(n,{className:"h-5 w-5 text-gray-400 dark:text-gray-500 mr-2"}),s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Connection Status"})]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:`h-2.5 w-2.5 rounded-full ${x?"bg-green-500 dark:bg-green-400":"bg-gray-300 dark:bg-gray-600"} mr-2`,"aria-hidden":"true"}),s.jsx("span",{className:"text-sm font-medium "+(x?"text-green-700 dark:text-green-400":"text-gray-500 dark:text-gray-500"),children:x?"Connected":"Disconnected"})]})]}),x&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Active Connections"}),s.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-dark-text",children:x.active_connections||0})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Queue Size"}),s.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-dark-text",children:g?.totalWaiting||0})]})]})]})]})]})};export{b as default};
